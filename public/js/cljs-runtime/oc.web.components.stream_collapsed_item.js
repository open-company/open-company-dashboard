goog.provide('oc.web.components.stream_collapsed_item');
/**
 * Safari is showing the full body in a tooltip as a feature when text-overflow is ellipsis.
 * To prevent it we need to add an empty div as first element of the body.
 */
oc.web.components.stream_collapsed_item.prefixed_html = (function oc$web$components$stream_collapsed_item$prefixed_html(html_string){
return ["<div class=\"hide-tooltip\"></div>",cljs.core.str.cljs$core$IFn$_invoke$arity$1(html_string)].join('');
});
oc.web.components.stream_collapsed_item.stream_item_summary = (function oc$web$components$stream_collapsed_item$stream_item_summary(activity_data){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"div.stream-item-body.oc-mentions","div.stream-item-body.oc-mentions",-357013753),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"data-itemuuid","data-itemuuid",1896878903),new cljs.core.Keyword(null,"uuid","uuid",-2145095719).cljs$core$IFn$_invoke$arity$1(activity_data),new cljs.core.Keyword(null,"dangerouslySetInnerHTML","dangerouslySetInnerHTML",-554971138),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"__html","__html",674048345),oc.web.components.stream_collapsed_item.prefixed_html(new cljs.core.Keyword(null,"body","body",-2049205669).cljs$core$IFn$_invoke$arity$1(activity_data))], null)], null)], null);
});
oc.web.components.stream_collapsed_item.stream_collapsed_item = rum.core.build_defcs((function (s,p__44656){
var map__44657 = p__44656;
var map__44657__$1 = (((((!((map__44657 == null))))?(((((map__44657.cljs$lang$protocol_mask$partition0$ & (64))) || ((cljs.core.PROTOCOL_SENTINEL === map__44657.cljs$core$ISeq$))))?true:false):false))?cljs.core.apply.cljs$core$IFn$_invoke$arity$2(cljs.core.hash_map,map__44657):map__44657);
var activity_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"activity-data","activity-data",1293689136));
var read_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"read-data","read-data",-715156010));
var comments_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"comments-data","comments-data",1871210833));
var editable_boards = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"editable-boards","editable-boards",1897056658));
var current_user_data = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"current-user-data","current-user-data",-1647873915));
var member_QMARK_ = cljs.core.get.cljs$core$IFn$_invoke$arity$2(map__44657__$1,new cljs.core.Keyword(null,"member?","member?",486668360));
var is_mobile_QMARK_ = oc.web.lib.responsive.is_mobile_size_QMARK_();
var current_board_slug = org.martinklepsch.derivatives.react(s,new cljs.core.Keyword(null,"board-slug","board-slug",99003663));
var current_activity_id = org.martinklepsch.derivatives.react(s,new cljs.core.Keyword(null,"activity-uuid","activity-uuid",-663317778));
var is_drafts_board = cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(current_board_slug,oc.web.lib.utils.default_drafts_board_slug);
var is_inbox_QMARK_ = cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(current_board_slug,"inbox");
var dom_element_id = ["stream-collapsed-item-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword(null,"uuid","uuid",-2145095719).cljs$core$IFn$_invoke$arity$1(activity_data))].join('');
var dom_node_class = ["stream-collapsed-item-",cljs.core.str.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword(null,"uuid","uuid",-2145095719).cljs$core$IFn$_invoke$arity$1(activity_data))].join('');
var is_published_QMARK_ = oc.web.utils.activity.is_published_QMARK_.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([activity_data], 0));
var publisher = (cljs.core.truth_(is_published_QMARK_)?new cljs.core.Keyword(null,"publisher","publisher",-153364540).cljs$core$IFn$_invoke$arity$1(activity_data):cljs.core.first(new cljs.core.Keyword(null,"author","author",2111686192).cljs$core$IFn$_invoke$arity$1(activity_data)));
var has_zero_comments_QMARK_ = (((cljs.core.count(new cljs.core.Keyword(null,"comments","comments",-293346423).cljs$core$IFn$_invoke$arity$1(activity_data)) === (0))) && ((cljs.core.count(new cljs.core.Keyword(null,"sorted-comments","sorted-comments",1988882718).cljs$core$IFn$_invoke$arity$1(cljs.core.get.cljs$core$IFn$_invoke$arity$2(comments_data,new cljs.core.Keyword(null,"uuid","uuid",-2145095719).cljs$core$IFn$_invoke$arity$1(activity_data)))) === (0))));
return React.createElement("div",({"data-last-activity-at": new cljs.core.Keyword(null,"last-activity-at","last-activity-at",670511998).cljs$core$IFn$_invoke$arity$1(activity_data), "data-last-read-at": new cljs.core.Keyword(null,"last-read-at","last-read-at",-216601930).cljs$core$IFn$_invoke$arity$1(activity_data), "onClick": (function (e){
if(is_drafts_board){
return oc.web.actions.activity.activity_edit.cljs$core$IFn$_invoke$arity$1(activity_data);
} else {
var more_menu_el = $(["#",dom_element_id," div.more-menu"].join('')).get((0));
var comments_summary_el = $(["#",dom_element_id," div.is-comments"].join('')).get((0));
if(((cljs.core.not(oc.web.lib.utils.event_inside_QMARK_(e,more_menu_el))) && (cljs.core.not(oc.web.lib.utils.event_inside_QMARK_(e,comments_summary_el))) && (cljs.core.not(oc.web.lib.utils.button_clicked_QMARK_(e))) && (cljs.core.not(oc.web.lib.utils.input_clicked_QMARK_(e))) && (cljs.core.not(oc.web.lib.utils.anchor_clicked_QMARK_(e))))){
return oc.web.actions.nav_sidebar.open_post_modal.cljs$core$IFn$_invoke$arity$2(activity_data,false);
} else {
return null;
}
}
}), "id": dom_element_id, "className": sablono.util.join_classes(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, ["stream-collapsed-item",oc.web.lib.utils.class_set(cljs.core.PersistentArrayMap.createAsIfByAssoc([dom_node_class,true,new cljs.core.Keyword(null,"draft","draft",1421831058),cljs.core.not(is_published_QMARK_),new cljs.core.Keyword(null,"unseen-item","unseen-item",-2083706536),new cljs.core.Keyword(null,"unseen","unseen",1063275592).cljs$core$IFn$_invoke$arity$1(activity_data),new cljs.core.Keyword(null,"unread-item","unread-item",-683556962),(function (){var or__4126__auto__ = (new cljs.core.Keyword(null,"new-comments-count","new-comments-count",46784695).cljs$core$IFn$_invoke$arity$1(activity_data) > (0));
if(or__4126__auto__){
return or__4126__auto__;
} else {
return new cljs.core.Keyword(null,"unread","unread",-1950424572).cljs$core$IFn$_invoke$arity$1(activity_data);
}
})(),new cljs.core.Keyword(null,"expandable","expandable",-704609097),is_published_QMARK_,new cljs.core.Keyword(null,"showing-share","showing-share",931530336),cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2(org.martinklepsch.derivatives.react(s,new cljs.core.Keyword(null,"activity-share-container","activity-share-container",-1384168706)),dom_element_id)]))], null))}),React.createElement("div",({"className": sablono.util.join_classes(new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, ["stream-collapsed-item-inner",oc.web.lib.utils.class_set(new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword(null,"must-see-item","must-see-item",-399380500),new cljs.core.Keyword(null,"must-see","must-see",-2009706697).cljs$core$IFn$_invoke$arity$1(activity_data),new cljs.core.Keyword(null,"bookmark-item","bookmark-item",1286116436),new cljs.core.Keyword(null,"bookmarked-at","bookmarked-at",1451784060).cljs$core$IFn$_invoke$arity$1(activity_data),new cljs.core.Keyword(null,"muted-item","muted-item",-1413795329),oc.web.lib.utils.link_for.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"links","links",-654507394).cljs$core$IFn$_invoke$arity$1(activity_data),"follow"], 0)),new cljs.core.Keyword(null,"no-comments","no-comments",999039490),has_zero_comments_QMARK_], null))], null))}),(function (){var attrs44670 = (function (){var G__44674 = new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"user-data","user-data",2143823568),publisher,new cljs.core.Keyword(null,"current-user-id","current-user-id",-2013633451),new cljs.core.Keyword(null,"user-id","user-id",-206822291).cljs$core$IFn$_invoke$arity$1(current_user_data)], null);
return (oc.web.components.ui.info_hover_views.user_info_hover.cljs$core$IFn$_invoke$arity$1 ? oc.web.components.ui.info_hover_views.user_info_hover.cljs$core$IFn$_invoke$arity$1(G__44674) : oc.web.components.ui.info_hover_views.user_info_hover.call(null,G__44674));
})();
return cljs.core.apply.cljs$core$IFn$_invoke$arity$4(React.createElement,"div",((cljs.core.map_QMARK_(attrs44670))?sablono.interpreter.attributes(sablono.normalize.merge_with_class.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, ["stream-collapsed-item-avatar-container"], null)], null),attrs44670], 0))):({"className": "stream-collapsed-item-avatar-container"})),((cljs.core.map_QMARK_(attrs44670))?new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (){var attrs44671 = (oc.web.components.ui.user_avatar.user_avatar_image.cljs$core$IFn$_invoke$arity$1 ? oc.web.components.ui.user_avatar.user_avatar_image.cljs$core$IFn$_invoke$arity$1(publisher) : oc.web.components.ui.user_avatar.user_avatar_image.call(null,publisher));
return cljs.core.apply.cljs$core$IFn$_invoke$arity$4(React.createElement,"div",((cljs.core.map_QMARK_(attrs44671))?sablono.interpreter.attributes(sablono.normalize.merge_with_class.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, ["stream-collapsed-item-avatar"], null)], null),attrs44671], 0))):({"className": "stream-collapsed-item-avatar"})),((cljs.core.map_QMARK_(attrs44671))?null:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [sablono.interpreter.interpret(attrs44671)], null)));
})()], null):new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [sablono.interpreter.interpret(attrs44670),(function (){var attrs44672 = (oc.web.components.ui.user_avatar.user_avatar_image.cljs$core$IFn$_invoke$arity$1 ? oc.web.components.ui.user_avatar.user_avatar_image.cljs$core$IFn$_invoke$arity$1(publisher) : oc.web.components.ui.user_avatar.user_avatar_image.call(null,publisher));
return cljs.core.apply.cljs$core$IFn$_invoke$arity$4(React.createElement,"div",((cljs.core.map_QMARK_(attrs44672))?sablono.interpreter.attributes(sablono.normalize.merge_with_class.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, ["stream-collapsed-item-avatar"], null)], null),attrs44672], 0))):({"className": "stream-collapsed-item-avatar"})),((cljs.core.map_QMARK_(attrs44672))?null:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [sablono.interpreter.interpret(attrs44672)], null)));
})()], null)));
})(),React.createElement("div",({"className": "stream-collapsed-item-fill"}),React.createElement("div",({"ref": "activity-headline", "data-itemuuid": new cljs.core.Keyword(null,"uuid","uuid",-2145095719).cljs$core$IFn$_invoke$arity$1(activity_data), "dangerouslySetInnerHTML": oc.web.lib.utils.emojify(new cljs.core.Keyword(null,"headline","headline",-157157727).cljs$core$IFn$_invoke$arity$1(activity_data)), "className": "stream-item-headline ap-seen-item-headline"})),React.createElement("div",({"className": "stream-collapsed-item-dot muted-dot"})),React.createElement("div",({"className": "muted-activity"})),React.createElement("div",({"className": "must-see-tag"})),React.createElement("div",({"className": "bookmark-tag-small"})),sablono.interpreter.interpret(oc.web.components.stream_collapsed_item.stream_item_summary(activity_data))),sablono.interpreter.interpret(((has_zero_comments_QMARK_)?null:(function (){var G__44684 = new cljs.core.PersistentArrayMap(null, 5, [new cljs.core.Keyword(null,"entry-data","entry-data",1970939662),activity_data,new cljs.core.Keyword(null,"comments-data","comments-data",1871210833),comments_data,new cljs.core.Keyword(null,"new-comments-count","new-comments-count",46784695),new cljs.core.Keyword(null,"new-comments-count","new-comments-count",46784695).cljs$core$IFn$_invoke$arity$1(activity_data),new cljs.core.Keyword(null,"hide-label?","hide-label?",628080329),is_mobile_QMARK_,new cljs.core.Keyword(null,"current-activity-id","current-activity-id",-930108529),current_activity_id], null);
return (oc.web.components.ui.comments_summary.comments_summary.cljs$core$IFn$_invoke$arity$1 ? oc.web.components.ui.comments_summary.comments_summary.cljs$core$IFn$_invoke$arity$1(G__44684) : oc.web.components.ui.comments_summary.comments_summary.call(null,G__44684));
})())),(function (){var attrs44673 = (function (){var t = (function (){var or__4126__auto__ = new cljs.core.Keyword(null,"published-at","published-at",249684621).cljs$core$IFn$_invoke$arity$1(activity_data);
if(cljs.core.truth_(or__4126__auto__)){
return or__4126__auto__;
} else {
return new cljs.core.Keyword(null,"created-at","created-at",-89248644).cljs$core$IFn$_invoke$arity$1(activity_data);
}
})();
return new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"time","time",1385887882),new cljs.core.PersistentArrayMap(null, 6, [new cljs.core.Keyword(null,"date-time","date-time",177938180),t,new cljs.core.Keyword(null,"data-toggle","data-toggle",436966687),(cljs.core.truth_(is_mobile_QMARK_)?null:"tooltip"),new cljs.core.Keyword(null,"data-placement","data-placement",166529525),"top",new cljs.core.Keyword(null,"data-container","data-container",1473653353),"body",new cljs.core.Keyword(null,"data-delay","data-delay",1974747786),"{\"show\":\"1000\", \"hide\":\"0\"}",new cljs.core.Keyword(null,"data-title","data-title",-83549535),oc.web.lib.utils.activity_date_tooltip(activity_data)], null),oc.web.lib.utils.foc_date_time(t)], null);
})();
return cljs.core.apply.cljs$core$IFn$_invoke$arity$4(React.createElement,"div",((cljs.core.map_QMARK_(attrs44673))?sablono.interpreter.attributes(sablono.normalize.merge_with_class.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, ["collapsed-time"], null)], null),attrs44673], 0))):({"className": "collapsed-time"})),((cljs.core.map_QMARK_(attrs44673))?null:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [sablono.interpreter.interpret(attrs44673)], null)));
})()),sablono.interpreter.interpret((function (){var G__44685 = cljs.core.PersistentHashMap.fromArrays([new cljs.core.Keyword(null,"show-delete?","show-delete?",-753527136),new cljs.core.Keyword(null,"show-edit?","show-edit?",-1476204765),new cljs.core.Keyword(null,"show-inbox?","show-inbox?",-1549891064),new cljs.core.Keyword(null,"external-share","external-share",-2131927863),new cljs.core.Keyword(null,"share-container-id","share-container-id",775325900),new cljs.core.Keyword(null,"entity-data","entity-data",1608056141),new cljs.core.Keyword(null,"editable-boards","editable-boards",1897056658),new cljs.core.Keyword(null,"show-move?","show-move?",274288117),new cljs.core.Keyword(null,"external-follow","external-follow",158310616),new cljs.core.Keyword(null,"external-bookmark","external-bookmark",-1631278980),new cljs.core.Keyword(null,"show-unread","show-unread",1139681406)],[true,true,is_inbox_QMARK_,cljs.core.not(is_mobile_QMARK_),dom_element_id,activity_data,editable_boards,cljs.core.not(is_mobile_QMARK_),cljs.core.not(is_mobile_QMARK_),cljs.core.not(is_mobile_QMARK_),cljs.core.not(new cljs.core.Keyword(null,"unread","unread",-1950424572).cljs$core$IFn$_invoke$arity$1(activity_data))]);
return (oc.web.components.ui.more_menu.more_menu.cljs$core$IFn$_invoke$arity$1 ? oc.web.components.ui.more_menu.more_menu.cljs$core$IFn$_invoke$arity$1(G__44685) : oc.web.components.ui.more_menu.more_menu.call(null,G__44685));
})()),React.createElement("div",({"className": "activity-share-container"})));
}),new cljs.core.PersistentVector(null, 5, 5, cljs.core.PersistentVector.EMPTY_NODE, [rum.core.static$,rum.core.reactive,org.martinklepsch.derivatives.drv.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"activity-share-container","activity-share-container",-1384168706)], 0)),org.martinklepsch.derivatives.drv.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"board-slug","board-slug",99003663)], 0)),org.martinklepsch.derivatives.drv.cljs$core$IFn$_invoke$arity$variadic(cljs.core.prim_seq.cljs$core$IFn$_invoke$arity$2([new cljs.core.Keyword(null,"activity-uuid","activity-uuid",-663317778)], 0))], null),"stream-collapsed-item");

//# sourceMappingURL=oc.web.components.stream_collapsed_item.js.map
