{"version":3,"sources":["oc/web/components/invite_email_modal.cljs"],"mappings":"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","names":["oc.web.components.invite-email-modal/close-clicked","s","dismiss-action","invite-users","p1__44722#","cljs.core/filterv","cljs.core/not","cljs.core/deref","org.martinklepsch.derivatives/get-ref","has-unsent-invites","cljs.core/count","p1__44723#","cljs.core/some","cljs.core/seq","alert-data","oc.web.components.ui.alert-modal/hide-alert","oc.web.components.ui.alert-modal/show-alert","oc.web.components.invite-email-modal/highlight-url","temp__5735__auto__","url-field","rum.core/ref-node","rum.core/build-defcs","js/React.createElement","attrs44724","cljs.core.apply","cljs.core/map?","sablono.interpreter/attributes","sablono.normalize.merge_with_class","sablono.util/join-classes","sablono.interpreter/interpret","oc.web.components.invite-email-modal/invite-email-modal","rum.core/reactive","org.martinklepsch.derivatives.drv","rum.core.local","org-data","oc.web.actions.org.get_org","oc.web.actions.team/teams-get","org.martinklepsch.derivatives/react","invite-users-data","team-data","cur-user-data","is-admin?","oc.web.lib.jwt/is-admin?","oc.web.actions.nav-sidebar/close-all-panels","_","oc.web.actions.nav-sidebar/show-org-settings","oc.web.lib.utils.link_for","e","oc.web.lib.utils/event-stop","url-input","copied?","oc.web.lib.utils/copy-to-clipboard","oc.web.actions.notifications/show-notification","cljs.core/reset!","oc.web.actions.team.delete_invite_token_link","success?","oc.web.actions.team.create_invite_token_link","oc.web.components.ui.invite-email/invite-email"],"sourcesContent":["(ns oc.web.components.invite-email-modal\n  (:require [rum.core :as rum]\n            [org.martinklepsch.derivatives :as drv]\n            [oc.web.lib.jwt :as jwt]\n            [oc.lib.user :as user-lib]\n            [oc.web.dispatcher :as dis]\n            [oc.web.lib.utils :as utils]\n            [oc.web.actions.nux :as nux-actions]\n            [oc.web.actions.org :as org-actions]\n            [oc.web.actions.team :as team-actions]\n            [oc.web.actions.nav-sidebar :as nav-actions]\n            [oc.web.components.ui.alert-modal :as alert-modal]\n            [oc.web.components.ui.invite-email :refer (invite-email)]\n            [oc.web.actions.notifications :as notification-actions]\n            [oc.web.components.ui.user-type-dropdown :refer (user-type-dropdown)]))\n\n(defn close-clicked [s dismiss-action]\n  (let [invite-users (filterv #(not (:error %)) (:invite-users @(drv/get-ref s :invite-data)))\n        has-unsent-invites (and (pos? (count invite-users))\n                                (some #(seq (:user %)) invite-users))]\n    (if has-unsent-invites\n      (let [alert-data {:icon \"/img/ML/trash.svg\"\n                        :action \"invite-unsaved-edits\"\n                        :message \"Leave without saving your changes?\"\n                        :link-button-title \"Stay\"\n                        :link-button-cb #(alert-modal/hide-alert)\n                        :solid-button-style :red\n                        :solid-button-title \"Lose changes\"\n                        :solid-button-cb #(do\n                                            (alert-modal/hide-alert)\n                                            (dismiss-action))}]\n        (alert-modal/show-alert alert-data))\n      (dismiss-action))))\n\n(defn- highlight-url\n  \"Select the whole content of the share link filed.\"\n  [s]\n  (when-let [url-field (rum/ref-node s \"invite-token-url-field\")]\n    (.select url-field)))\n\n(rum/defcs invite-email-modal <  ;; Mixins\n  rum/reactive\n  (drv/drv :org-data)\n  (drv/drv :invite-data)\n  ;; Locals\n  (rum/local false ::creating-invite-link)\n  {:will-mount (fn [s]\n    (let [org-data @(drv/get-ref s :org-data)]\n      (org-actions/get-org org-data true)\n      (team-actions/teams-get))\n    s)}\n  [s]\n  (let [org-data (drv/react s :org-data)\n        invite-users-data (drv/react s :invite-data)\n        team-data (:team-data invite-users-data)\n        invite-users (:invite-users invite-users-data)\n        cur-user-data (:current-user-data invite-users-data)\n        is-admin? (jwt/is-admin? (:team-id org-data))]\n    [:div.invite-email-modal\n      [:button.mlb-reset.modal-close-bt\n        {:on-click #(close-clicked s nav-actions/close-all-panels)}]\n      [:div.invite-email-modal-inner\n        [:div.invite-email-header\n          [:div.invite-email-header-title\n            \"Invite via email\"]\n          [:button.mlb-reset.cancel-bt\n            {:on-click (fn [_] (close-clicked s #(nav-actions/show-org-settings nil)))}\n            \"Back\"]]\n        [:div.invite-email-body\n          (when is-admin?\n            (if (seq (:invite-token team-data))\n              [:div.invite-token-container\n                [:div.invite-token-title\n                  \"Share an invite link\"]\n                [:div.invite-token-description\n                  \"Anyone can use this link to join your Wut team as a \"\n                  [:strong \"contributor\"]\n                  \".\"]\n                [:div.invite-token-description\n                  \"Invite link\"]\n                [:div.invite-token-field\n                  [:input.invite-token-field-input\n                    {:value (:href (utils/link-for (:links team-data) \"invite-token\"))\n                     :read-only true\n                     :ref \"invite-token-url-field\"\n                     :content-editable false\n                     :on-click #(highlight-url s)}]\n                  [:button.mlb-reset.invite-token-field-bt\n                    {:ref \"invite-token-copy-btn\"\n                     :on-click (fn [e]\n                                (utils/event-stop e)\n                                (let [url-input (rum/ref-node s \"invite-token-url-field\")]\n                                  (highlight-url s)\n                                  (let [copied? (utils/copy-to-clipboard url-input)]\n                                    (notification-actions/show-notification {:title (if copied? \"Invite URL copied to clipboard\" \"Error copying the URL\")\n                                                                             :description (when-not copied? \"Please try copying the URL manually\")\n                                                                             :primary-bt-title \"OK\"\n                                                                             :primary-bt-dismiss true\n                                                                             :primary-bt-inline copied?\n                                                                             :expire 3\n                                                                             :id (if copied? :invite-token-url-copied :invite-token-url-copy-error)}))))}\n                    \"Copy\"]]\n                [:button.mlb-reset.deactivate-link-bt\n                  {:on-click (fn [_]\n                               (let [alert-data {:icon \"/img/ML/trash.svg\"\n                                                 :action \"deactivate-invite-email-link\"\n                                                 :title \"Are you sure?\"\n                                                 :message \"Anyone that has this link already won't be able to use it to access your team.\"\n                                                 :solid-button-title \"OK, got it\"\n                                                 :solid-button-cb #(do\n                                                                    (alert-modal/hide-alert)\n                                                                    (reset! (::creating-invite-link s) true)\n                                                                    (team-actions/delete-invite-token-link (utils/link-for (:links team-data) \"delete-invite-link\")\n                                                                     (fn [success?]\n                                                                      (reset! (::creating-invite-link s) false))))\n                                                 :solid-button-style :red\n                                                 :link-button-title \"No, keep it\"\n                                                 :link-button-cb #(alert-modal/hide-alert)}]\n                                 (alert-modal/show-alert alert-data)))\n                   :disabled @(::creating-invite-link s)}\n                  \"Deactivate invite link\"]]\n              [:div.invite-token-container\n                [:div.invite-token-title\n                  \"Share an invite link\"]\n                [:div.invite-token-description\n                  \"Anyone can use this link to join your Wut team as a \"\n                  [:strong \"contributor\"]\n                  \".\"]\n                [:button.mlb-reset.generate-link-bt\n                  {:on-click #(do \n                               (reset! (::creating-invite-link s) true)\n                               (team-actions/create-invite-token-link\n                                (utils/link-for (:links team-data) \"create-invite-link\")\n                                (fn [success?]\n                                 (reset! (::creating-invite-link s) false))))\n                   :disabled @(::creating-invite-link s)}\n                  \"Generate invite link\"]]))\n          [:div.invites-list-container\n            {:class (when is-admin? \"top-border\")}\n            [:div.invites-list-title\n              \"Invite someone with a specific role\"]\n            [:div.invites-list-description\n              \"Admin, Contributor, or Viewer\"]\n            (invite-email)]]]]))"]}