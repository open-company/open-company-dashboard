shadow$provide.module$node_modules$$sentry$core$dist$baseclient=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var tslib_1=require("module$node_modules$tslib$tslib"),hub_1=require("module$node_modules$$sentry$hub$dist$index"),utils_1=require("module$node_modules$$sentry$utils$dist$index"),integration_1=require("module$node_modules$$sentry$core$dist$integration");global=function(){function BaseClient(backendClass,options){this._integrations={};this._processing=
!1;this._backend=new backendClass(options);this._options=options;options.dsn&&(this._dsn=new utils_1.Dsn(options.dsn))}BaseClient.prototype.captureException=function(exception,hint,scope){var _this=this,eventId=hint&&hint.event_id;this._processing=!0;this._getBackend().eventFromException(exception,hint).then(function(event){eventId=_this.captureEvent(event,hint,scope)});return eventId};BaseClient.prototype.captureMessage=function(message,level,hint,scope){var _this=this,eventId=hint&&hint.event_id;
this._processing=!0;(utils_1.isPrimitive(message)?this._getBackend().eventFromMessage(""+message,level,hint):this._getBackend().eventFromException(message,hint)).then(function(event){eventId=_this.captureEvent(event,hint,scope)});return eventId};BaseClient.prototype.captureEvent=function(event,hint,scope){var _this=this,eventId=hint&&hint.event_id;this._processing=!0;this._processEvent(event,hint,scope).then(function(finalEvent){eventId=finalEvent&&finalEvent.event_id;_this._processing=!1}).then(null,
function(reason){utils_1.logger.error(reason);_this._processing=!1});return eventId};BaseClient.prototype.getDsn=function(){return this._dsn};BaseClient.prototype.getOptions=function(){return this._options};BaseClient.prototype.flush=function(timeout){var _this=this;return this._isClientProcessing(timeout).then(function(status){clearInterval(status.interval);return _this._getBackend().getTransport().close(timeout).then(function(transportFlushed){return status.ready&&transportFlushed})})};BaseClient.prototype.close=
function(timeout){var _this=this;return this.flush(timeout).then(function(result){_this.getOptions().enabled=!1;return result})};BaseClient.prototype.setupIntegrations=function(){this._isEnabled()&&(this._integrations=integration_1.setupIntegrations(this._options))};BaseClient.prototype.getIntegration=function(integration){try{return this._integrations[integration.id]||null}catch(_oO){return utils_1.logger.warn("Cannot retrieve integration "+integration.id+" from the current Client"),null}};BaseClient.prototype._isClientProcessing=
function(timeout){var _this=this;return new utils_1.SyncPromise(function(resolve){var ticked=0,interval=0;clearInterval(interval);interval=setInterval(function(){_this._processing?(ticked+=1,timeout&&ticked>=timeout&&resolve({interval:interval,ready:!1})):resolve({interval:interval,ready:!0})},1)})};BaseClient.prototype._getBackend=function(){return this._backend};BaseClient.prototype._isEnabled=function(){return!1!==this.getOptions().enabled&&void 0!==this._dsn};BaseClient.prototype._prepareEvent=
function(event,scope,hint){var _this=this,_a=this.getOptions().normalizeDepth,normalizeDepth=void 0===_a?3:_a;event=tslib_1.__assign(tslib_1.__assign({},event),{event_id:event.event_id||(hint&&hint.event_id?hint.event_id:utils_1.uuid4()),timestamp:event.timestamp||utils_1.timestampWithMs()});this._applyClientOptions(event);this._applyIntegrationsMetadata(event);hint&&hint.captureContext&&(scope=hub_1.Scope.clone(scope).update(hint.captureContext));_a=utils_1.SyncPromise.resolve(event);scope&&(_a=
scope.applyToEvent(event,hint));return _a.then(function(evt){return"number"===typeof normalizeDepth&&0<normalizeDepth?_this._normalizeEvent(evt,normalizeDepth):evt})};BaseClient.prototype._normalizeEvent=function(event,depth){if(!event)return null;var normalized=tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign(tslib_1.__assign({},event),event.breadcrumbs&&{breadcrumbs:event.breadcrumbs.map(function(b){return tslib_1.__assign(tslib_1.__assign({},b),b.data&&{data:utils_1.normalize(b.data,
depth)})})}),event.user&&{user:utils_1.normalize(event.user,depth)}),event.contexts&&{contexts:utils_1.normalize(event.contexts,depth)}),event.extra&&{extra:utils_1.normalize(event.extra,depth)});event.contexts&&event.contexts.trace&&(normalized.contexts.trace=event.contexts.trace);return normalized};BaseClient.prototype._applyClientOptions=function(event){var _a=this.getOptions(),environment=_a.environment,release=_a.release,dist=_a.dist;_a=_a.maxValueLength;_a=void 0===_a?250:_a;void 0===event.environment&&
void 0!==environment&&(event.environment=environment);void 0===event.release&&void 0!==release&&(event.release=release);void 0===event.dist&&void 0!==dist&&(event.dist=dist);event.message&&(event.message=utils_1.truncate(event.message,_a));(environment=event.exception&&event.exception.values&&event.exception.values[0])&&environment.value&&(environment.value=utils_1.truncate(environment.value,_a));(event=event.request)&&event.url&&(event.url=utils_1.truncate(event.url,_a))};BaseClient.prototype._applyIntegrationsMetadata=
function(event){event=event.sdk;var integrationsArray=Object.keys(this._integrations);event&&0<integrationsArray.length&&(event.integrations=integrationsArray)};BaseClient.prototype._sendEvent=function(event){this._getBackend().sendEvent(event)};BaseClient.prototype._processEvent=function(event,hint,scope){var _this=this,_a=this.getOptions(),beforeSend=_a.beforeSend;_a=_a.sampleRate;if(!this._isEnabled())return utils_1.SyncPromise.reject("SDK not enabled, will not send event.");var isTransaction=
"transaction"===event.type;return!isTransaction&&"number"===typeof _a&&Math.random()>_a?utils_1.SyncPromise.reject("This event has been sampled, will not send event."):new utils_1.SyncPromise(function(resolve,reject){_this._prepareEvent(event,scope,hint).then(function(prepared){if(null===prepared)reject("An event processor returned null, will not send event.");else{var finalEvent=prepared;hint&&hint.data&&!0===hint.data.__sentry__||!beforeSend||isTransaction?(_this._sendEvent(finalEvent),resolve(finalEvent)):
(prepared=beforeSend(prepared,hint),"undefined"===typeof prepared?utils_1.logger.error("`beforeSend` method has to return `null` or a valid event."):utils_1.isThenable(prepared)?_this._handleAsyncBeforeSend(prepared,resolve,reject):(finalEvent=prepared,null===finalEvent?(utils_1.logger.log("`beforeSend` returned `null`, will not send event."),resolve(null)):(_this._sendEvent(finalEvent),resolve(finalEvent))))}}).then(null,function(reason){_this.captureException(reason,{data:{__sentry__:!0},originalException:reason});
reject("Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: "+reason)})})};BaseClient.prototype._handleAsyncBeforeSend=function(beforeSend,resolve,reject){var _this=this;beforeSend.then(function(processedEvent){null===processedEvent?reject("`beforeSend` returned `null`, will not send event."):(_this._sendEvent(processedEvent),resolve(processedEvent))}).then(null,function(e){reject("beforeSend rejected with "+e)})};return BaseClient}();
exports.BaseClient=global}
//# sourceMappingURL=module$node_modules$$sentry$core$dist$baseclient.js.map
