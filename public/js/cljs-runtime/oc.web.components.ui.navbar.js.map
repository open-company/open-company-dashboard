{"version":3,"sources":["oc/web/components/ui/navbar.cljs"],"mappings":";AAyBA,AAAA,AAAOA,AAAaC,AAAEC;AAAtB,AACE,AAACC,AAAY,AAACC,AAAcF;;AAE9B,AAAA,AAAKG;AAEL,AAAA,AAAOC,AAAcC,AAAEN;AAAvB,AACE,AAAM,AAAK,AAAG,AAAA,AAAIO,AAA0CH,AACjD,AAAA,AAAAI,AAACC,AAAK,AAAA,AAAYH;AAD7B,AAEE,AAAA,AAACI,AAAO,AAAA,AAAYJ;;AAFtB;;AAGA,AAAM,AAAA,AAAAE,AAAA,AAAK,AAAI,AAAA,AAAID,AAA0CH,AACjD,AAAA,AAAYE;AADxB,AAEE,AAAA,AAACI,AAAO,AAAA,AAAYJ;;AAFtB;;;AAIF,AAAA,AAAAK,AAAA,AAAWe,AAqBRpB;AArBH,AAAA,AAAA,AAAAM,AAkC0B,AAAA,AAACoC,AAAU1C;AAlCrCM,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAAA,AAkCamC;AAlCb,AAAA/B,AAAAJ,AAAA,AAsBgBuB;AAtBhB,AAAAnB,AAAAJ,AAAA,AAyBgB0B;AAzBhB,AAAAtB,AAAAJ,AAAA,AA6BgB8B;AA7BhB,AAAA1B,AAAAJ,AAAA,AA+BgBgC;AA/BhB,AAAA5B,AAAAJ,AAAA,AAiCgBkC;AAjChB,AAAA9B,AAAAJ,AAAA,AA0BgB2B;AA1BhB,AAAAvB,AAAAJ,AAAA,AAwBgByB;AAxBhB,AAAArB,AAAAJ,AAAA,AA2BgB4B;AA3BhB,AAAAxB,AAAAJ,AAAA,AA4BgB6B;AA5BhB,AAAAzB,AAAAJ,AAAA,AAuBgBwB;AAvBhB,AAAApB,AAAAJ,AAAA,AA8BgB+B;AA9BhB,AAAA3B,AAAAJ,AAAA,AAgCgBiC;AAGPI,AAAW,AAACC;AACZC,AAAc,AAACC,AAAKV;AACpBW,AAAmB,AAAA,AAACC,AAAEH;AACtBI,AAAY,AAAA,AAACP,AAAU1C;AACvBkD,AAAa,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AACC,AAAA,AAACF,AAAE,AAACG,AAAQb,AAEZ,AAAA,AAACU,AAAE,AAACG,AAAQb,AAEZ,AAAA,AAACU,AAAE,AAACG,AAAQb,AAEZ,AAAA,AAACU,AAAE,AAACG,AAAQb,AAEZ,AAAA,AAACU,AAAE,AAACG,AAAQb,AAEZ,AAAA,AAACU,AAAE,AAACG,AAAQb,AAEZ,AAAAc,AAAKb;AAAL,AAAA,AAAAa;AAA8B,AAAA,AAAQrB;;AAAtCqB;;AAbD,AAAA,AAeC,AAAAA,AAAKb;AAAL,AAAA,AAAAa;AAA8B,AAACrC,AAAKgB;;AAApCqB;;AAfD,AAgBC,AAAA,AAAOrB,AAEP,AAAA,AAAOD;;AACrBuB,AAAe,AAACX,AAAU1C,AAAE0B;AA1DrC,AAAA,AAAAf,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AA4Dc,AAAA,AAAA,AAAA,AAAA,AAAC0C,AAAqCtB,AACAe,AACD,AAAAK,AAAKf;AAAL,AAAA,AAAAe;AACK,AAAA,AACC,AAAA,AACC,AAAA,AAAA,AAACG,AAAe,AAAA,AAAQ1B;;AAH/BuB;;AAFrC,AAAA,AAMyCnB,AAEP,AAAAmB,AAAKf;AAAL,AAAA,AAAAe;AACK,AAACjD,AAAI,AAAA,AAAY0B;;AADtBuB;;AApEhD,AAAAvC,AAAA,AAsEM,AAAA,AAAA,AAAU,AAAC2C,AACT,AAACC,AAAAA,AAAAA,AACC,AAAAL,AAAKT;AAAL,AAAA,AAAAS;AACKC;;AADLD;;AAxEV,AAAAzC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AA4EuB,AAAKjB;AAAL,AACE,AAACgE,AAAiBhE;;AAClB,AAACiE;;AACD,AAACC;AA/E1B,AAAA,AAAAjD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAG,AAqFc,AAAA,AAAA,AAAA,AAAA,AAAA,AAAI6B;AAAJ,AAEgB,AAAA,AAAA,AAAA,AAAA,AAACkB,AAAoD1D;AACnE,AAAC2D,AAAAA,AAAAA;AAxFjB,AAAA,AAAAtD,AAAAG,AAAA,AAAA,AAAA,AAAAI,AAAAD,AAAA,AAAAE,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAAD,AAAA,AAAA,AAAA,AAAAD,AAAAC;AAAA,AAAA,AAAAH,AAAA,AAAA,AAAA,AAAA,AAAAO,AAyFgByB,AAGEO;AA5FlB,AAAA,AAAA1C,AAAAG,AAAA,AAAA,AAAA,AAAAI,AAAAG,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAAG,AAAA,AAAA,AAAA,AAAAL,AAAAK;AAAA,AAAAP,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAAF,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAC,AA8FwB,AAAA,AAAA,AAAA,AAAMqB,AACd,AAAC6B,AAAAA,AAAAA,AACD,AAACC,AAIW,AAAA,AAAA,AAAA,AAAM7B,AACd,AAAA8B,AAAA,AAAA,AAAA;AAAA,AACa,AAACE;;AADd,AAAA,AAAAF,AAAAA,AAACC,AAAAA,AAAAA;AArGrB,AAAA/C,AAwGgB,AAACiD,AAAAA,AAAAA;AAxGjB,AAAA,AAAA5D,AAAAG,AAAA,AAAA,AAAA,AAAAI,AAAAI,AAAA,AAAAH,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAA,AAAA,AAAA,AAAA,AAAAJ,AAAAI,AAAA,AAAA,AAAA,AAAAN,AAAAM;;AAAA,AAAoBE,AACA,AAAA,AAACC,AACD,AAAA,AAACA,AACD,AAAA,AAACA,AACD,AAAA,AAACC,AACD,AAAA,AAAA,AAACC,AACD,AAAA,AAAA,AAACA,AACD,AAACC,AAAiC,AAAKzB,AAAEN;AAAP,AACjC,AAAA,AAAAQ,AAAO,AAAA,AAA0BF;AAAjC,AACE,AAAA,AAAAE,AAAQ,AAAA,AAA0BF;;AADpC;;AARrB,AAAA,AAUoB,AAACsB,AAAQI,AACI,AAAK1B;AAAL,AACX,AAACI,AAAO,AAAA,AAA0BJ,AAAG,AAAA2B,AAAA,AAAW,AAACC,AAAQ7B,AAAaC;;AACvEA;AAbrB,AAcgC,AAAKA;AAAL,AACV,AAAA,AAAAE,AAAQ,AAAA,AAA0BF;;AACnCA;AAhBrB,AAiBmC,AAAKA;AAAL,AACb,AAAA,AAAAE,AAAO,AAAA,AAA0BF;AAAjC,AACE,AAAA,AAAAE,AAAW,AAAA,AAA0BF;;AADvC;;AAEDA;AApBrB","names":["oc.web.components.ui.navbar/mobile-nav!","e","board-slug","oc.web.router/nav!","oc.web.urls.board","oc.web.components.ui.navbar/scroll-top-offset","oc.web.components.ui.navbar/check-scroll","s","js/document","cljs.core/deref","cljs.core/not","cljs.core/reset!","rum.core/build-defcs","map__46001","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","js/React.createElement","sablono.util/join-classes","sablono.interpreter/interpret","attrs46005","cljs.core/map?","sablono.interpreter/attributes","sablono.normalize.merge_with_class","attrs46006","attrs46007","oc.web.components.ui.navbar/navbar","rum.core/reactive","org.martinklepsch.derivatives.drv","oc.web.mixins.ui/render-on-resize","rum.core.local","oc.web.mixins.ui/on-window-scroll-mixin","oc.web.stores.search/search-active?","js/goog.async.Throttle","cljs.core.partial","org-data","board-data","contributions-user-data","show-login-overlay","orgs-dropdown-visible","search-active","show-whats-new-green-dot","panel-stack","current-org-slug","current-board-slug","current-contributions-id","current-user-data","navbar-data","org.martinklepsch.derivatives/react","is-mobile?","oc.web.lib.responsive/is-mobile-size?","current-panel","cljs.core/last","expanded-user-menu","cljs.core._EQ_","cmail-state","mobile-title","cljs.core.keyword","and__4115__auto__","search-active?","oc.web.lib.utils/class-set","oc.web.lib.utils.link_for","oc.web.lib.utils/is-test-env?","oc.web.components.ui.login-overlay/login-overlays-handler","oc.web.lib.utils/event-stop","oc.web.actions.search/reset","oc.web.actions.search/inactive","oc.web.dispatcher/dispatch!","oc.web.components.ui.orgs-dropdown/orgs-dropdown","oc.web.components.search/search-box","oc.web.lib.jwt/jwt","G__46008","oc.web.components.ui.user-avatar/user-avatar","oc.web.actions.nav-sidebar/menu-toggle","oc.web.components.ui.login-button/login-button"],"sourcesContent":["(ns oc.web.components.ui.navbar\n  (:require [rum.core :as rum]\n            [org.martinklepsch.derivatives :as drv]\n            [dommy.core :as dommy :refer-macros (sel1)]\n            [oc.web.lib.jwt :as jwt]\n            [oc.web.urls :as oc-urls]\n            [oc.lib.user :as lib-user]\n            [oc.web.router :as router]\n            [oc.web.dispatcher :as dis]\n            [oc.web.lib.utils :as utils]\n            [oc.web.mixins.ui :as ui-mixins]\n            [oc.web.stores.search :as search]\n            [oc.web.components.ui.menu :as menu]\n            [oc.web.utils.ui :refer (ui-compose)]\n            [oc.web.lib.responsive :as responsive]\n            [oc.web.actions.search :as search-actions]\n            [oc.web.actions.nav-sidebar :as nav-actions]\n            [oc.web.components.search :refer (search-box)]\n            [oc.web.components.ui.user-avatar :refer (user-avatar)]\n            [oc.web.components.ui.login-button :refer (login-button)]\n            [oc.web.components.ui.orgs-dropdown :refer (orgs-dropdown)]\n            [oc.web.components.navigation-sidebar :as navigation-sidebar]\n            [oc.web.components.ui.login-overlay :refer (login-overlays-handler)])\n  (:import [goog.async Throttle]))\n\n(defn- mobile-nav! [e board-slug]\n  (router/nav! (oc-urls/board board-slug)))\n\n(def scroll-top-offset 46)\n\n(defn- check-scroll [s e]\n  (when (and (> (.. js/document -scrollingElement -scrollTop) scroll-top-offset)\n             (not @(::scrolled s)))\n    (reset! (::scrolled s) true))\n  (when (and (<= (.. js/document -scrollingElement -scrollTop) scroll-top-offset)\n             @(::scrolled s))\n    (reset! (::scrolled s) false)))\n\n(rum/defcs navbar < rum/reactive\n                    (drv/drv :navbar-data)\n                    (drv/drv :cmail-state)\n                    (drv/drv :show-add-post-tooltip)\n                    (ui-mixins/render-on-resize nil)\n                    (rum/local nil ::throttled-scroll-check)\n                    (rum/local false ::scrolled)\n                    (ui-mixins/on-window-scroll-mixin (fn [s e]\n                     (when @(::throttled-scroll-check s)\n                       (.fire @(::throttled-scroll-check s)))))\n                    (drv/drv search/search-active?)\n                    {:will-mount (fn [s]\n                      (reset! (::throttled-scroll-check s) (Throttle. (partial check-scroll s) 500))\n                     s)\n                     :did-mount (fn [s]\n                      (.fire @(::throttled-scroll-check s))\n                     s)\n                     :will-unmount (fn [s]\n                      (when @(::throttled-scroll-check s)\n                        (.dispose @(::throttled-scroll-check s)))\n                     s)}\n  [s]\n  (let [{:keys [org-data\n                board-data\n                contributions-user-data\n                show-login-overlay\n                orgs-dropdown-visible\n                search-active\n                show-whats-new-green-dot\n                panel-stack\n                current-org-slug\n                current-board-slug\n                current-contributions-id\n                current-user-data]\n         :as navbar-data} (drv/react s :navbar-data)\n         is-mobile? (responsive/is-mobile-size?)\n         current-panel (last panel-stack)\n         expanded-user-menu (= current-panel :menu)\n         cmail-state (drv/react s :cmail-state)\n         mobile-title (cond\n                       (= (keyword current-board-slug) :replies)\n                       \"For you\"\n                       (= (keyword current-board-slug) :inbox)\n                       \"Unread\"\n                       (= (keyword current-board-slug) :all-posts)\n                       \"All\"\n                       (= (keyword current-board-slug) :bookmarks)\n                       \"Bookmarks\"\n                       (= (keyword current-board-slug) :following)\n                       \"Home\"\n                       (= (keyword current-board-slug) :topics)\n                       \"Explore\"\n                       (and current-contributions-id (:self? contributions-user-data))\n                       \"You\"\n                       (and current-contributions-id (map? contributions-user-data))\n                       (:name contributions-user-data)\n                       :else\n                       (:name board-data))\n         search-active? (drv/react s search/search-active?)]\n    [:nav.oc-navbar.group\n      {:class (utils/class-set {:show-login-overlay show-login-overlay\n                                :expanded-user-menu expanded-user-menu\n                                :has-prior-updates (and current-org-slug\n                                                        (pos?\n                                                         (:count\n                                                          (utils/link-for (:links org-data) \"collection\" \"GET\"))))\n                                :showing-orgs-dropdown orgs-dropdown-visible\n\n                                :can-edit-board (and current-org-slug\n                                                     (not (:read-only org-data)))})}\n      (when-not (utils/is-test-env?)\n        (login-overlays-handler))\n      (if (and is-mobile?\n               search-active?)\n        [:div.mobile-header\n          [:button.mlb-reset.search-close-bt\n            {:on-click (fn [e]\n                         (utils/event-stop e)\n                         (search-actions/reset)\n                         (search-actions/inactive))}]\n          [:div.mobile-header-title\n            \"Search\"]]\n        [:div.oc-navbar-header.group\n          [:div.oc-navbar-header-container.group\n            [:div.navbar-left\n              (if is-mobile?\n                [:button.mlb-reset.mobile-ham-menu\n                  {:on-click #(dis/dispatch! [:update [:mobile-navigation-sidebar] not])}]\n                (orgs-dropdown))]\n            (if is-mobile?\n              [:div.navbar-center\n                [:div.navbar-mobile-title\n                  mobile-title]]\n              [:div.navbar-center\n                {:class (when search-active \"search-active\")}\n                (search-box)])\n            (if (jwt/jwt)\n              [:div.navbar-right.group\n                [:div.user-menu\n                  [:div.user-menu-button\n                    {:class (when show-whats-new-green-dot \"green-dot\")}\n                    (user-avatar\n                     {:click-cb #(nav-actions/menu-toggle)})]]]\n              [:div.navbar-right.anonymous-user\n                (login-button)])]])]))\n"]}