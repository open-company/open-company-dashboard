{"version":3,"sources":["oc/web/components/stream_collapsed_item.cljs"],"mappings":";AAcA;;;;AAAA,AAAOA,AAGJC;AAHH,AAIE,AAAA,AAA0CA;;AAE5C,AAAA,AAAOC,AAAqBC;AAA5B,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAEoB,AAAA,AAAOA,AACY,AAACH,AAAc,AAAA,AAAOG;;AAE7D,AAAA,AAAAC,AAAA,AAAAC,AAAWgB,AAKRI;AALH,AAAA,AAAAnB,AAAAD;AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAAC,AAAA,AAAAD,AAAA,AAAA,AAAA,AAAA,AAAAE,AAAAC,AAAAH,AAAAA;AAAA,AAAAI,AAAAJ,AAAA,AAKaH;AALb,AAAAO,AAAAJ,AAAA,AAK2BoB;AAL3B,AAAAhB,AAAAJ,AAAA,AAKqCqB;AALrC,AAAAjB,AAAAJ,AAAA,AAKmDsB;AALnD,AAAAlB,AAAAJ,AAAA,AAKmEuB;AALnE,AAAAnB,AAAAJ,AAAA,AAKqFwB;AALrF,AAAA,AAAA,AAMQC,AAAW,AAACC;AACZC,AAAmB,AAAA,AAACC,AAAUT;AAC9BU,AAAoB,AAAA,AAACD,AAAUT;AAC/BW,AAAgB,AAACC,AAAEJ,AAAmBK;AACtCC,AAAU,AAAA,AAACF,AAAEJ;AACbO,AAAe,AAAA,AAA8B,AAAA,AAAOrC;AACpDsC,AAAe,AAAA,AAA8B,AAAA,AAAOtC;AACpDuC,AAAc,AAACC,AAAiBxC;AAChCyC,AAAU,AAAIF,AACF,AAAA,AAAYvC,AACZ,AAAC0C,AAAM,AAAA,AAAS1C;AAC5B2C,AAAmB,AAAK,AAAA,AAAA,AAAA,AAAA,AAAI3C,AAAwB4C,AAC5B,AAAA,AAAA,AAAA,AAAA,AAAIpB,AAAc,AAACjB,AAAI,AAAA,AAAOP,AAAiC4C;AAlB/F,AAAA,AAAApC,AAAA,AAAA,AA2B8B,AAAA,AAAmBR,AACvB,AAAA,AAAeA,AAExB,AAAKgD;AAAL,AACE,AAAIf;AACF,AAACgB,AAA+BjD;;AAChC,AAAMkD,AAAa,AAAA,AAAM,AAACC,AAAK,AAAA,AAAA,AAASd;AAClCe,AAAoB,AAAA,AAAM,AAACD,AAAK,AAAA,AAAA,AAASd;AAD/C,AAEE,AAAM,AACK,AAACS,AAAI,AAACO,AAAoBL,AAAEE,AAE5B,AAACJ,AAAI,AAACO,AAAoBL,AAAEI,AAE5B,AAACN,AAAI,AAACQ,AAAsBN,AAE5B,AAACF,AAAI,AAACS,AAAqBP,AAE3B,AAACF,AAAI,AAACU,AAAsBR;AATvC,AAUE,AAAA,AAACS,AAA4BzD;;AAV/B;;;AAnCvB,AAAAS,AAAA,AAAA,AAoBc,AAAA,AAAA,AAAA,AAAA,AAAA,AAACoC,AAAiBP,AACO,AAACQ,AAAIP,AACC,AAAA,AAASvC,AACT,AAAA+C,AAAI,AAAA,AAAM,AAAA,AAAqB/C,AAuBjEqC;AAvBkC,AAAA,AAAAU;AAAAA;;AACI,AAAA,AAAS/C;;AAxB1D,AAAAQ,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAAC,AAoBc,AAAA,AAK8B6B,AACG,AAACL,AAAE,AAAA,AAACH,AAAUT,AAA6Be,AAsB1E,AAAA,AAAA,AAAA,AAAA,AAAA,AAACQ,AAAgC,AAAA,AAAW7C,AACX,AAAA,AAAgBA,AACnB,AAAA,AAAC0D,AAAe,AAAA,AAAQ1D,AACvB2C,AAErC,AAAAgB,AAAA,AAAA,AAAA,AAA6BlB,AAA2B,AAAA,AAAUf;AAAlE,AAAA,AAAAiC,AAAAA,AAACC,AAAAA,AAAAA;;AArDX,AAAA,AAAAvD,AAAAG,AAAA,AAAA,AAAA,AAAAG,AAAAD,AAAA,AAAAE,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAAD,AAAA,AAAA,AAAAI,AAuDY,AAAC+C,AAAAA,AAAAA,AAAkBpB,AAAAA;AAvD/B,AAAA,AAAApC,AAAAG,AAAA,AAAA,AAAA,AAAAG,AAAAG,AAAA,AAAAF,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAH,AAAAG,AAAA,AAAA,AAAA,AAAAC,AAAAD;AAAA,AAAA,AAAAC,AAAAL,AAAA,AAAAM,AAuDY,AAAC6C,AAAAA,AAAAA,AAAkBpB,AAAAA;AAvD/B,AAAA,AAAApC,AAAAG,AAAA,AAAA,AAAA,AAAAG,AAAAK,AAAA,AAAAJ,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAG,AAAA,AAAA,AAAA,AAAA,AAAAL,AAAAK,AAAA,AAAA,AAAA,AAAAD,AAAAC;;AAAA,AAAAR,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAA,AAAA,AAAA,AAAA,AAAA,AAAAO,AAAA,AAAAA,AA2D4B,AAAA,AAAOf,AACG,AAAC8D,AAAc,AAAA,AAAW9D,AAKtD,AAACD,AAAoBC,AACvB,AAAA,AAAA,AAAU2C,AACR,AAAAoB,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAA+B/D,AACGwB,AACK,AAAA,AAAqBxB,AAC5B4B,AACQI;AAJxC,AAAA,AAAA+B,AAAAA,AAACC,AAAAA,AAAAA;AAnEX,AAAA/C,AAyEU,AAAMgD,AAAE,AAAAlB,AAAI,AAAA,AAAe/C;AAAnB,AAAA,AAAA+C;AAAAA;;AAAkC,AAAA,AAAa/C;;;AAAvD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAEgBiE,AACE,AAAA,AAAA,AAAA,AAAUrC,AAIX,AAACsC,AAA4BlE,AAC1C,AAACmE,AAAoBF;;AAjFnC,AAAA,AAAA5D,AAAAG,AAAA,AAAA,AAAA,AAAAG,AAAAM,AAAA,AAAAL,AAAA,AAAAC,AAAA,AAAA,AAAA,AAAA,AAAAI,AAAA,AAAA,AAAA,AAAA,AAAAN,AAAAM,AAAA,AAAA,AAAA,AAAAF,AAAAE;AAAA,AAAAF,AAkFM,AAAAqD,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAA,AAAyBpE,AACOqC,AACHZ,AACD,AAACqB,AAAIlB,AACF,AAACkB,AAAIlB,AACP,AAACkB,AAAIlB,AAGT,AAACkB,AAAI,AAAA,AAAS9C,AACf,AAAC8C,AAAIlB,AACJQ;AAVzB,AAAA,AAAAgC,AAAAA,AAACC,AAAAA,AAAAA;AAlFP,AAAA7D,AAAA,AAAA,AAAA;AAAA,AAAA,AAAmCW,AACAC,AACA,AAAA,AAACC,AACD,AAAA,AAACA,AACD,AAAA,AAACA","names":["oc.web.components.stream-collapsed-item/prefixed-html","html-string","oc.web.components.stream-collapsed-item/stream-item-summary","activity-data","rum.core/build-defcs","p__44656","map__44657","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","js/React.createElement","sablono.util/join-classes","attrs44670","cljs.core/map?","sablono.interpreter/attributes","sablono.normalize.merge_with_class","attrs44671","sablono.interpreter/interpret","attrs44672","attrs44673","oc.web.components.stream-collapsed-item/stream-collapsed-item","rum.core/static","rum.core/reactive","org.martinklepsch.derivatives.drv","s","read-data","comments-data","editable-boards","current-user-data","member?","is-mobile?","oc.web.lib.responsive/is-mobile-size?","current-board-slug","org.martinklepsch.derivatives/react","current-activity-id","is-drafts-board","cljs.core._EQ_","oc.web.lib.utils/default-drafts-board-slug","is-inbox?","dom-element-id","dom-node-class","is-published?","oc.web.utils.activity.is_published_QMARK_","publisher","cljs.core/first","has-zero-comments?","cljs.core/count","oc.web.lib.utils/class-set","cljs.core/not","or__4126__auto__","e","oc.web.actions.activity.activity_edit","more-menu-el","js/$","comments-summary-el","oc.web.lib.utils/event-inside?","oc.web.lib.utils/button-clicked?","oc.web.lib.utils/input-clicked?","oc.web.lib.utils/anchor-clicked?","oc.web.actions.nav_sidebar.open_post_modal","oc.web.lib.utils.link_for","G__44674","oc.web.components.ui.info-hover-views/user-info-hover","oc.web.components.ui.user-avatar/user-avatar-image","oc.web.lib.utils/emojify","G__44684","oc.web.components.ui.comments-summary/comments-summary","t","oc.web.lib.utils/activity-date-tooltip","oc.web.lib.utils/foc-date-time","G__44685","oc.web.components.ui.more-menu/more-menu"],"sourcesContent":["(ns oc.web.components.stream-collapsed-item\n  (:require [rum.core :as rum]\n            [org.martinklepsch.derivatives :as drv]\n            [oc.web.lib.jwt :as jwt]\n            [oc.web.lib.utils :as utils]\n            [oc.web.utils.activity :as au]\n            [oc.web.lib.responsive :as responsive]\n            [oc.web.actions.nav-sidebar :as nav-actions]\n            [oc.web.actions.activity :as activity-actions]\n            [oc.web.components.ui.more-menu :refer (more-menu)]\n            [oc.web.components.ui.user-avatar :refer (user-avatar-image)]\n            [oc.web.components.ui.comments-summary :refer (comments-summary)]\n            [oc.web.components.ui.info-hover-views :refer (user-info-hover)]))\n\n(defn- prefixed-html\n  \"Safari is showing the full body in a tooltip as a feature when text-overflow is ellipsis.\n   To prevent it we need to add an empty div as first element of the body.\"\n  [html-string]\n  (str \"<div class=\\\"hide-tooltip\\\"></div>\" html-string))\n\n(defn- stream-item-summary [activity-data]\n  [:div.stream-item-body.oc-mentions\n    {:data-itemuuid (:uuid activity-data)\n     :dangerouslySetInnerHTML {:__html (prefixed-html (:body activity-data))}}])\n\n(rum/defcs stream-collapsed-item < rum/static\n                                   rum/reactive\n                                   (drv/drv :activity-share-container)\n                                   (drv/drv :board-slug)\n                                   (drv/drv :activity-uuid)\n  [s {:keys [activity-data read-data comments-data editable-boards current-user-data member?]}]\n  (let [is-mobile? (responsive/is-mobile-size?)\n        current-board-slug (drv/react s :board-slug)\n        current-activity-id (drv/react s :activity-uuid)\n        is-drafts-board (= current-board-slug utils/default-drafts-board-slug)\n        is-inbox? (= current-board-slug \"inbox\")\n        dom-element-id (str \"stream-collapsed-item-\" (:uuid activity-data))\n        dom-node-class (str \"stream-collapsed-item-\" (:uuid activity-data))\n        is-published? (au/is-published? activity-data)\n        publisher (if is-published?\n                    (:publisher activity-data)\n                    (first (:author activity-data)))\n        has-zero-comments? (and (-> activity-data :comments count zero?)\n                                (-> comments-data (get (:uuid activity-data)) :sorted-comments count zero?))]\n    [:div.stream-collapsed-item\n      {:class (utils/class-set {dom-node-class true\n                                :draft (not is-published?)\n                                :unseen-item (:unseen activity-data)\n                                :unread-item (or (pos? (:new-comments-count activity-data))\n                                                 (:unread activity-data))\n                                :expandable is-published?\n                                :showing-share (= (drv/react s :activity-share-container) dom-element-id)})\n       :data-last-activity-at (:last-activity-at activity-data)\n       :data-last-read-at (:last-read-at activity-data)\n       ;; click on the whole tile only for draft editing\n       :on-click (fn [e]\n                   (if is-drafts-board\n                     (activity-actions/activity-edit activity-data)\n                     (let [more-menu-el (.get (js/$ (str \"#\" dom-element-id \" div.more-menu\")) 0)\n                           comments-summary-el (.get (js/$ (str \"#\" dom-element-id \" div.is-comments\")) 0)]\n                       (when (and ;; More menu wasn't clicked\n                                  (not (utils/event-inside? e more-menu-el))\n                                  ;; Comments summary wasn't clicked\n                                  (not (utils/event-inside? e comments-summary-el))\n                                  ;; a button wasn't clicked\n                                  (not (utils/button-clicked? e))\n                                  ;; No input field clicked\n                                  (not (utils/input-clicked? e))\n                                  ;; No body link was clicked\n                                  (not (utils/anchor-clicked? e)))\n                         (nav-actions/open-post-modal activity-data false)))))\n       :id dom-element-id}\n      [:div.stream-collapsed-item-inner\n        {:class (utils/class-set {:must-see-item (:must-see activity-data)\n                                  :bookmark-item (:bookmarked-at activity-data)\n                                  :muted-item (utils/link-for (:links activity-data) \"follow\")\n                                  :no-comments has-zero-comments?})}\n        [:div.stream-collapsed-item-avatar-container\n          (user-info-hover {:user-data publisher :current-user-id (:user-id current-user-data)})\n          [:div.stream-collapsed-item-avatar\n            (user-avatar-image publisher)]]\n        [:div.stream-collapsed-item-fill\n          [:div.stream-item-headline.ap-seen-item-headline\n            {:ref \"activity-headline\"\n             :data-itemuuid (:uuid activity-data)\n             :dangerouslySetInnerHTML (utils/emojify (:headline activity-data))}]\n          [:div.stream-collapsed-item-dot.muted-dot]\n          [:div.muted-activity]\n          [:div.must-see-tag]\n          [:div.bookmark-tag-small]\n          (stream-item-summary activity-data)]\n        (when-not has-zero-comments?\n          (comments-summary {:entry-data activity-data\n                             :comments-data comments-data\n                             :new-comments-count (:new-comments-count activity-data)\n                             :hide-label? is-mobile?\n                             :current-activity-id current-activity-id}))\n        [:div.collapsed-time\n          (let [t (or (:published-at activity-data) (:created-at activity-data))]\n            [:time\n              {:date-time t\n               :data-toggle (when-not is-mobile? \"tooltip\")\n               :data-placement \"top\"\n               :data-container \"body\"\n               :data-delay \"{\\\"show\\\":\\\"1000\\\", \\\"hide\\\":\\\"0\\\"}\"\n               :data-title (utils/activity-date-tooltip activity-data)}\n              (utils/foc-date-time t)])]]\n      (more-menu {:entity-data activity-data\n                  :share-container-id dom-element-id\n                  :editable-boards editable-boards\n                  :external-share (not is-mobile?)\n                  :external-bookmark (not is-mobile?)\n                  :external-follow (not is-mobile?)\n                  :show-edit? true\n                  :show-delete? true\n                  :show-unread (not (:unread activity-data))\n                  :show-move? (not is-mobile?)\n                  :show-inbox? is-inbox?})\n      [:div.activity-share-container]]))"]}