!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("MediumEditor"));else if("function"==typeof define&&define.amd)define(["MediumEditor"],e);else{var i=e("object"==typeof exports?require("MediumEditor"):t.MediumEditor);for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(this,function(t){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){return t[t.length-1]}function s(t,e){var i=t.parentNode;l.default.util.unwrap(t,e);for(var n=i.lastChild,a=n.previousSibling;a;)3===n.nodeType&&3===a.nodeType&&(a.textContent+=n.textContent,i.removeChild(n)),n=a,a=n.previousSibling}Object.defineProperty(e,"__esModule",{value:!0}),e.TCMention=e.LEFT_ARROW_KEYCODE=void 0,e.unwrapForTextNode=s;var r=i(1),l=n(r),o=e.LEFT_ARROW_KEYCODE=37,h=e.TCMention=l.default.Extension.extend({name:"mention",extraClassName:"",extraActiveClassName:"",extraPanelClassName:"",extraActivePanelClassName:"",extraTriggerClassNameMap:{},extraActiveTriggerClassNameMap:{},tagName:"strong",renderPanelContent:function(){},destroyPanelContent:function(){},activeTriggerList:["@"],triggerClassNameMap:{"#":"medium-editor-mention-hash","@":"medium-editor-mention-at"},activeTriggerClassNameMap:{"#":"medium-editor-mention-hash-active","@":"medium-editor-mention-at-active"},hideOnBlurDelay:300,init:function(){this.initMentionPanel(),this.attachEventHandlers()},destroy:function(){this.detachEventHandlers(),this.destroyMentionPanel()},initMentionPanel:function(){var t=this.document.createElement("div");t.classList.add("medium-editor-mention-panel"),(this.extraPanelClassName||this.extraClassName)&&t.classList.add(this.extraPanelClassName||this.extraClassName),this.getEditorOption("elementsContainer").appendChild(t),this.mentionPanel=t},destroyMentionPanel:function(){this.mentionPanel&&(this.mentionPanel.parentNode&&(this.destroyPanelContent(this.mentionPanel),this.mentionPanel.parentNode.removeChild(this.mentionPanel)),delete this.mentionPanel)},attachEventHandlers:function(){var t=this;this.unsubscribeCallbacks=[];var e=function(e,i){var n=t[i].bind(t);t.subscribe(e,n),t.unsubscribeCallbacks.push(function(){t.base.unsubscribe(e,n)})};null!==this.hideOnBlurDelay&&void 0!==this.hideOnBlurDelay&&(e("blur","handleBlur"),e("focus","handleFocus")),e("editableKeyup","handleKeyup")},detachEventHandlers:function(){this.hideOnBlurDelayId&&clearTimeout(this.hideOnBlurDelayId),this.unsubscribeCallbacks&&(this.unsubscribeCallbacks.forEach(function(t){return t()}),this.unsubscribeCallbacks=null)},handleBlur:function(){var t=this;null!==this.hideOnBlurDelay&&void 0!==this.hideOnBlurDelay&&(this.hideOnBlurDelayId=setTimeout(function(){t.hidePanel(!1)},this.hideOnBlurDelay))},handleFocus:function(){this.hideOnBlurDelayId&&(clearTimeout(this.hideOnBlurDelayId),this.hideOnBlurDelayId=null)},handleKeyup:function(t){var e=l.default.util.getKeyCode(t),i=e===l.default.util.keyCode.SPACE;this.getWordFromSelection(t.target,i?-1:0),!i&&this.activeTriggerList.indexOf(this.trigger)!==-1&&this.word.length>1?this.showPanel():(this.hidePanel(e===o),this.activeMentionAt&&this.activeMentionAt.parentNode&&(this.base.saveSelection(),s(this.activeMentionAt,this.document),this.base.restoreSelection()))},hidePanel:function(t){this.mentionPanel.classList.remove("medium-editor-mention-panel-active");var e=this.extraActivePanelClassName||this.extraActiveClassName;if(e&&this.mentionPanel.classList.remove(e),this.activeMentionAt&&(this.activeMentionAt.classList.remove(this.activeTriggerClassName),this.extraActiveTriggerClassName&&this.activeMentionAt.classList.remove(this.extraActiveTriggerClassName)),this.activeMentionAt){var i=this.activeMentionAt,n=i.parentNode,r=i.previousSibling,o=i.nextSibling,h=i.firstChild,d=t?r:o,c=void 0;d?3!==d.nodeType?(c=this.document.createTextNode(""),n.insertBefore(c,d)):c=d:(c=this.document.createTextNode(""),n.appendChild(c));var u=a(h.textContent),m=0===u.trim().length;if(m){var g=h.textContent;h.textContent=g.substr(0,g.length-1),c.textContent=""+u+c.textContent}else 0===c.textContent.length&&h.textContent.length>1&&(c.textContent="Â ");t?l.default.selection.select(this.document,c,c.length):l.default.selection.select(this.document,c,Math.min(c.length,1)),h.textContent.length<=1&&(this.base.saveSelection(),s(this.activeMentionAt,this.document),this.base.restoreSelection()),this.activeMentionAt=null}},getWordFromSelection:function(t,e){function i(t,e){var n=o[t-1];return null===n||void 0===n?t:0===n.trim().length||t<=0||o.length<t?t:i(t+e,e)}var n=l.default.selection.getSelectionRange(this.document),a=n.startContainer,s=n.startOffset,r=n.endContainer;if(a===r){var o=a.textContent;this.wordStart=i(s+e,-1),this.wordEnd=i(s+e,1)-1,this.word=o.slice(this.wordStart,this.wordEnd),this.trigger=this.word.slice(0,1),this.triggerClassName=this.triggerClassNameMap[this.trigger],this.activeTriggerClassName=this.activeTriggerClassNameMap[this.trigger],this.extraTriggerClassName=this.extraTriggerClassNameMap[this.trigger],this.extraActiveTriggerClassName=this.extraActiveTriggerClassNameMap[this.trigger]}},showPanel:function(){this.mentionPanel.classList.contains("medium-editor-mention-panel-active")||(this.activatePanel(),this.wrapWordInMentionAt()),this.updatePanelContent(),this.positionPanel()},activatePanel:function(){this.mentionPanel.classList.add("medium-editor-mention-panel-active"),(this.extraActivePanelClassName||this.extraActiveClassName)&&this.mentionPanel.classList.add(this.extraActivePanelClassName||this.extraActiveClassName)},wrapWordInMentionAt:function(){var t=this.document.getSelection();if(t.rangeCount){var e=t.getRangeAt(0).cloneRange();if(e.startContainer.parentNode.classList.contains(this.triggerClassName))this.activeMentionAt=e.startContainer.parentNode;else{var i=Math.min(this.wordEnd,e.startContainer.textContent.length);e.setStart(e.startContainer,this.wordStart),e.setEnd(e.startContainer,i);var n=this.document.createElement(this.tagName);n.classList.add(this.triggerClassName),this.extraTriggerClassName&&n.classList.add(this.extraTriggerClassName),this.activeMentionAt=n,e.surroundContents(n),t.removeAllRanges(),t.addRange(e),l.default.selection.select(this.document,this.activeMentionAt.firstChild,this.word.length)}this.activeMentionAt.classList.add(this.activeTriggerClassName),this.extraActiveTriggerClassName&&this.activeMentionAt.classList.add(this.extraActiveTriggerClassName)}},positionPanel:function(){var t=this.activeMentionAt.getBoundingClientRect(),e=t.top,i=t.bottom,n=t.left,a=this.window,s=a.pageXOffset,r=a.pageYOffset,l=this.document.documentElement.clientHeight||this.window.innerHeight,o=s+n,h=i>l/2?r+e-this.mentionPanel.clientHeight:r+i-this.mentionPanel.clientHeight;this.mentionPanel.style.top=h+"px",this.mentionPanel.style.left=o+"px"},updatePanelContent:function(){this.renderPanelContent(this.mentionPanel,this.word,this.handleSelectMention.bind(this))},handleSelectMention:function(t,e){if(t){var i=this.activeMentionAt.firstChild;e.name&&e.name.length>0&&this.activeMentionAt.setAttribute("data-name",e.name),e["first-name"]&&e["first-name"].length>0&&this.activeMentionAt.setAttribute("data-first-name",e["first-name"]),e["last-name"]&&e["last-name"].length>0&&this.activeMentionAt.setAttribute("data-last-name",e["last-name"]),e["slack-username"]&&e["slack-username"].length>0?this.activeMentionAt.setAttribute("data-slack-username",e["slack-username"]):e["slack-usernames"]&&e["slack-usernames"].length>0&&this.activeMentionAt.setAttribute("data-slack-username",e["slack-usernames"][0]),e["user-id"]&&e["user-id"].length>0&&this.activeMentionAt.setAttribute("data-user-id",e["user-id"]),e.email&&e.email.length>0&&this.activeMentionAt.setAttribute("data-email",e.email),e["avatar-url"]&&e["avatar-url"].length>0&&this.activeMentionAt.setAttribute("data-avatar-url",e["avatar-url"]),this.activeMentionAt.setAttribute("data-found","true"),i.textContent=t,l.default.selection.select(this.document,i,t.length);var n=this.base.getFocusedElement();n&&this.base.events.updateInput(n,{target:n,currentTarget:n}),this.hidePanel(!1)}else this.hidePanel(!1)}});e.default=h},function(e,i){e.exports=t}])});
//# sourceMappingURL=index.min.js.map